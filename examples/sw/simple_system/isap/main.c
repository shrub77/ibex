#include "types.h"
#include "isap.h"
#include "crypto_aead.h"
#include "ascon.h"
#include "simple_system_common.h"
#define NELEMS(x)  (sizeof(x) / sizeof((x)[0]))
const unsigned char ISAP_IV_KE2[] = {0x03,ISAP_K,ISAP_rH,ISAP_rB,ISAP_sH,ISAP_sB,ISAP_sE,ISAP_sK};



int main(int argc, char **argv) 
{

    static const unsigned char key[] = {0x45,0x7A,0x29,0xE2,0xB7,0x4B,0xAA,0x76,0x28,0xC1,0x39,0x41,0x44,0xE6,0xAC,0x6A};
    
    static const unsigned char npub[] = {0xCD,0xB2,0x3E,0xDD,0xB0,0x68,0xCA,0x4B,0x77,0x44,0x37,0xDC,0xEA,0x81,0x07,0x62};
    static const unsigned char ad[] = {0x23,0x04,0xD9,0x52,0x34,0xF7,0x07,0x4A,0xC6,0x10,0xA6,0x31,0x3C,0xEE,0xA9,0xB2};
    static const unsigned char pt[] = {0xED,0x43,0x0E,0x9C,0x1E,0x78,0xEE,0xA2,0x6C,0x06,0xE3,0x00,0xE1,0x9A,0xF8,0x6E};
    unsigned char ct[32];

    static const unsigned char expected[] = {0x17,0x99,0xC3,0x76,0x62,0x8B,0xBC,0x0E,0x79,0xA9,0xBC,0x16,0xE0,0xE4,0x2B,0xFB, 0x89,0x87,0xF1,0x26,0x4C,0x91,0x04,0x20,0xD1,0x52,0xA9,0x2C,0x42,0x98,0x4D,0x00};
    unsigned long long ct_len = 16ULL, pt_len = 16ULL ,ad_len = 16ULL;

    // Expected
    // ct      = 1799C376628BBC0E79A9BC16E0E42BFB
    // tag     = 8987F1264C910420D152A92C42984D00

    crypto_aead_encrypt(ct, &ct_len, pt, pt_len, ad, ad_len, 0, npub, key);
    for(int i = 0; i < ct_len; i++)
    {
        if(expected[i] != ct[i])
        {
            puts("FAIL");
            return -1;
        }
    }
    puts("PASS");
    return 0;
}